<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>BINGO TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body {
  margin:0;
  font-family:Arial,sans-serif;
  background:radial-gradient(circle at top,#ffd000,#ff7a00);
  display:flex;
  flex-direction:column;
  align-items:center;
  color:white;
}
h1 { margin:10px; }

#number {
  width:260px;height:260px;
  border-radius:50%;
  background:white;
  color:black;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:120px;
  font-weight:bold;
  box-shadow:0 0 30px rgba(0,0,0,.4);
}
.animate { animation:pop .6s ease; }
@keyframes pop {
  0%{transform:scale(0)}
  70%{transform:scale(1.2)}
  100%{transform:scale(1)}
}

.controls { margin:15px; display:flex; gap:12px; }
button {
  padding:12px 20px;
  font-size:16px;
  border:none;
  border-radius:10px;
  background:#222;
  color:white;
  cursor:pointer;
}
button.reset { background:#b30000; }
button.win { background:#0a8f3d; }

#drawn {
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  max-width:1000px;
}
.drawn-number {
  width:50px;height:50px;
  border-radius:50%;
  background:white;
  color:black;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

/* === ÎšÎŸÎ¥Î ÎŸÎÎ™ GRID === */
#ticket {
  display:grid;
  grid-template-columns:repeat(5, 1fr);
  gap:12px;
  margin:20px auto;
  max-width:360px;
}

.cell {
  width:60px;height:60px;
  border-radius:50%;
  background:#eee;
  color:black;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  cursor:pointer;
}
.cell.marked { background:#ff5252;color:white; }

input { padding:10px;font-size:16px;margin-top:10px;text-align:center }
#qr { margin-top:10px }
</style>
</head>

<body>

<h1>BINGO HALL</h1>

<div id="number">â€“</div>

<div class="controls">
  <button id="manualBtn">MANUAL</button>
  <button id="autoBtn">AUTO</button>
  <button id="stopBtn" disabled>STOP</button>
  <button id="resetBtn" class="reset">RESET</button>
</div>

<div id="drawn"></div>

<h3>ÎšÎ¿Ï…Ï€ÏŒÎ½Î¹ Ï€Î±Î¯ÎºÏ„Î·</h3>
<input id="name" placeholder="ÎŒÎ½Î¿Î¼Î±">
<button id="createTicketBtn">Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ QR</button>
<img id="qr" width="160">

<script>
const params = new URLSearchParams(location.search);
const ticketParam = params.get("ticket");

/* ================== ÎšÎŸÎ¥Î ÎŸÎÎ™ ================== */
if(ticketParam){
  const data = JSON.parse(atob(ticketParam));
  const drawn = JSON.parse(localStorage.getItem("drawnNumbers")||"[]");

  document.body.innerHTML = `
    <h2>${data.name}</h2>
    <p>ğŸ†” ÎšÎ¿Ï…Ï€ÏŒÎ½Î¹: <b>${data.id}</b></p>
    <div id="ticket"></div>
    <button class="win" id="checkWin">Î•Î›Î•Î“Î§ÎŸÎ£ ÎÎ™ÎšÎ—Î£</button>
    <p id="result"></p>
  `;

  const ticket = document.getElementById("ticket");
  data.nums.forEach(n=>{
    const c=document.createElement("div");
    c.className="cell";
    c.textContent=n;
    c.onclick=()=>c.classList.toggle("marked");
    ticket.appendChild(c);
  });

  document.getElementById("checkWin").onclick=()=>{
    const marked=[...document.querySelectorAll(".cell.marked")].map(c=>+c.textContent);
    if(marked.length===0) return alert("ÎœÎ±ÏÎºÎ¬ÏÎ¹ÏƒÎµ Î½Î¿ÏÎ¼ÎµÏÎ±");

    const ok = marked.every(n=>drawn.includes(n));
    document.getElementById("result").textContent =
      ok ? `ğŸ‰ BINGO! ÎšÎ¿Ï…Ï€ÏŒÎ½Î¹ ${data.id}` : "âŒ Î”ÎµÎ½ Î­Ï‡Î¿Ï…Î½ ÎºÎ»Î·ÏÏ‰Î¸ÎµÎ¯ ÏŒÎ»Î±";
  };
  throw "";
}

/* ================== TV ÎšÎ›Î—Î¡Î©Î£Î— ================== */
let numbers=[], drawn=[], interval=null, running=false;

function initGame(){
  numbers=Array.from({length:75},(_,i)=>i+1);
  drawn=[];
  document.getElementById("drawn").innerHTML="";
  document.getElementById("number").textContent="â€“";
  localStorage.setItem("drawnNumbers","[]");
}

function drawNumber(){
  if(numbers.length===0){ stopAuto(); alert("Î¤Î­Î»Î¿Ï‚!"); return; }
  const i=Math.floor(Math.random()*numbers.length);
  const n=numbers.splice(i,1)[0];
  drawn.push(n);
  localStorage.setItem("drawnNumbers",JSON.stringify(drawn));

  const numberDiv=document.getElementById("number");
  numberDiv.textContent=n;
  numberDiv.classList.remove("animate");
  void numberDiv.offsetWidth;
  numberDiv.classList.add("animate");

  const d=document.createElement("div");
  d.className="drawn-number";
  d.textContent=n;
  document.getElementById("drawn").appendChild(d);
}

manualBtn.onclick=()=>{ if(!running) drawNumber(); };
autoBtn.onclick=()=>{
  if(running) return;
  running=true;
  autoBtn.disabled=true;
  manualBtn.disabled=true;
  stopBtn.disabled=false;
  drawNumber();
  interval=setInterval(drawNumber,5000);
};
function stopAuto(){
  running=false;
  clearInterval(interval);
  autoBtn.disabled=false;
  manualBtn.disabled=false;
  stopBtn.disabled=true;
}
stopBtn.onclick=stopAuto;
resetBtn.onclick=()=>{ stopAuto(); initGame(); };

initGame();

/* ================== QR ================== */
createTicketBtn.onclick=async()=>{
  const name=document.getElementById("name").value.trim();
  if(!name) return alert("Î’Î¬Î»Îµ ÏŒÎ½Î¿Î¼Î±");

  const ticketId="BINGO-"+Math.floor(100000+Math.random()*900000);

  let nums=[];
  while(nums.length<15){
    let n=Math.floor(Math.random()*75)+1;
    if(!nums.includes(n)) nums.push(n);
  }

  const data=btoa(JSON.stringify({id:ticketId,name,nums}));
  const link=location.origin+location.pathname+"?ticket="+data;
  qr.src=await QRCode.toDataURL(link);
};
</script>

</body>
</html>

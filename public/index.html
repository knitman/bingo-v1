<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>BINGO TV + QR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #ffd000, #ff7a00);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh;
  padding: 20px;
  color: white;
}

h1 { margin-bottom: 10px; text-align:center; }

#number {
  width: 260px; height: 260px;
  border-radius: 50%;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 120px;
  font-weight: bold;
  color: #000;
  box-shadow: 0 0 30px rgba(0,0,0,0.3);
  margin-bottom: 20px;
}

.animate { animation: pop 0.6s ease; }
@keyframes pop {
  0% { transform: scale(0); }
  70% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.controls {
  margin: 15px 0;
  display: flex;
  gap: 15px;
}

button {
  padding: 12px 20px;
  font-size: 16px;
  border: none;
  border-radius: 10px;
  background: #222;
  color: white;
  cursor: pointer;
}
button:disabled { opacity: 0.5; }

#drawn {
  width: 90%; max-width: 1000px;
  display: flex; flex-wrap: wrap; gap: 8px;
  justify-content: center;
  margin-top: 10px;
}
.drawn-number {
  width: 50px; height: 50px;
  border-radius: 50%;
  background: #ffffff;
  border: 2px solid #222;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: #000;
}

/* QR & Ticket Pop-up */
#ticketOverlay {
  position: fixed;
  inset:0;
  background: rgba(0,0,0,0.95);
  display: none;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  z-index: 999;
}
#ticket {
  display: grid;
  grid-template-columns: repeat(5,1fr);
  gap: 10px;
  margin-top: 20px;
}
.cell {
  width: 60px; height: 60px;
  border-radius: 50%;
  background: #eee;
  color: black;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
}
.cell.marked { background: #ff5252; color:white; }

input { padding:10px; font-size:16px; margin-top:10px; width:200px; text-align:center; }
#qr { margin-top:10px; }
</style>
</head>

<body>

<h1>BINGO HALL</h1>

<!-- Κεντρικός αριθμός -->
<div id="number">–</div>

<!-- Κουμπιά κλήρωσης -->
<div class="controls">
  <button id="manualBtn">MANUAL</button>
  <button id="autoBtn">AUTO</button>
  <button id="stopBtn" disabled>STOP</button>
</div>

<!-- Ιστορικό κληρωμένων -->
<div id="drawn"></div>

<!-- Δημιουργία κουπονιού -->
<h3>Δημιουργία κουπονιού</h3>
<input id="name" placeholder="Όνομα παίκτη">
<button id="createTicketBtn">ΔΗΜΙΟΥΡΓΙΑ QR</button><br>
<img id="qr" width="180">

<!-- Pop-up κουπόνι -->
<div id="ticketOverlay">
  <h2 id="playerName"></h2>
  <div id="ticket"></div>
  <button onclick="closeTicket()">ΚΛΕΙΣΙΜΟ</button>
</div>

<script>
// ====== ΚΛΗΡΩΣΗ ======
let numbers = Array.from({length:75},(_,i)=>i+1);
let interval=null;
let running=false;

const numberDiv = document.getElementById("number");
const drawnDiv = document.getElementById("drawn");
const manualBtn = document.getElementById("manualBtn");
const autoBtn = document.getElementById("autoBtn");
const stopBtn = document.getElementById("stopBtn");

function drawNumber() {
  if(numbers.length===0){ stopAuto(); alert("Τέλος αριθμών!"); return; }
  const index = Math.floor(Math.random()*numbers.length);
  const num = numbers.splice(index,1)[0];

  numberDiv.textContent=num;
  numberDiv.classList.remove("animate");
  void numberDiv.offsetWidth;
  numberDiv.classList.add("animate");

  const el = document.createElement("div");
  el.className="drawn-number";
  el.textContent=num;
  drawnDiv.appendChild(el);
}

manualBtn.onclick=()=>{ if(running) return; drawNumber(); };
autoBtn.onclick=()=>{
  if(running) return;
  running=true;
  autoBtn.disabled=true; manualBtn.disabled=true; stopBtn.disabled=false;
  drawNumber();
  interval=setInterval(drawNumber,5000);
};
function stopAuto(){
  running=false; clearInterval(interval); interval=null;
  autoBtn.disabled=false; manualBtn.disabled=false; stopBtn.disabled=true;
}
stopBtn.onclick=stopAuto;

// ====== Δημιουργία κουπονιού + QR ======
document.getElementById("createTicketBtn").onclick = async () => {
  const name = document.getElementById("name").value.trim();
  if(!name) return alert("Βάλε όνομα");

  let nums=[];
  while(nums.length<15){
    let n=Math.floor(Math.random()*75)+1;
    if(!nums.includes(n)) nums.push(n);
  }

  const data=btoa(JSON.stringify({name,nums}));
  const link=location.origin+location.pathname+"?ticket="+encodeURIComponent(data);
  document.getElementById("qr").src = await QRCode.toDataURL(link);
};

// ====== Pop-up κουπόνι ======
function openTicket(data){
  const {name, nums} = JSON.parse(atob(data));
  document.getElementById("playerName").innerText=name;
  const grid=document.getElementById("ticket");
  grid.innerHTML="";
  nums.forEach(n=>{
    const d=document.createElement("div");
    d.className="cell";
    d.innerText=n;
    d.onclick=()=>d.classList.toggle("marked");
    grid.appendChild(d);
  });
  document.getElementById("ticketOverlay").style.display="flex";
}
function closeTicket(){ document.getElementById("ticketOverlay").style.display="none"; }

// Αν ανοίξει URL με ticket param
const params=new URLSearchParams(location.search);
const t=params.get("ticket");
if(t){ numberDiv.style.display="none"; openTicket(t); }
</script>

</body>
</html>

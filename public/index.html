<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>BINGO TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body {
  margin:0;
  font-family:Arial,sans-serif;
  background:radial-gradient(circle at top,#ffd000,#ff7a00);
  display:flex;
  flex-direction:column;
  align-items:center;
  color:white;
}

h1 { margin:10px; }

#number {
  width:260px;height:260px;
  border-radius:50%;
  background:white;
  color:black;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:120px;
  font-weight:bold;
  box-shadow:0 0 30px rgba(0,0,0,.4);
}

.animate { animation:pop .6s ease; }
@keyframes pop {
  0%{transform:scale(0)}
  70%{transform:scale(1.2)}
  100%{transform:scale(1)}
}

.controls {
  margin:15px;
  display:flex;
  gap:12px;
}

button {
  padding:12px 20px;
  font-size:16px;
  border:none;
  border-radius:10px;
  background:#222;
  color:white;
  cursor:pointer;
}
button.reset { background:#b30000; }
button:disabled { opacity:.5; }

#drawn {
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  max-width:1000px;
}
.drawn-number {
  width:50px;height:50px;
  border-radius:50%;
  background:white;
  color:black;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

#ticketOverlay {
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  flex-direction:column;
  align-items:center;
  padding:20px;
}

#ticket {
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:10px;
  margin-top:20px;
}
.cell {
  width:60px;height:60px;
  border-radius:50%;
  background:#eee;
  color:black;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  cursor:pointer;
}
.cell.marked { background:#ff5252;color:white; }

input { padding:10px;font-size:16px;margin-top:10px;text-align:center }
#qr { margin-top:10px }
</style>
</head>

<body>

<h1>BINGO HALL</h1>

<div id="number">–</div>

<div class="controls">
  <button id="manualBtn">MANUAL</button>
  <button id="autoBtn">AUTO</button>
  <button id="stopBtn" disabled>STOP</button>
  <button id="resetBtn" class="reset">RESET</button>
</div>

<div id="drawn"></div>

<h3>Κουπόνι παίκτη</h3>
<input id="name" placeholder="Όνομα">
<button id="createTicketBtn">ΔΗΜΙΟΥΡΓΙΑ QR</button>
<img id="qr" width="160">

<div id="ticketOverlay">
  <h2 id="playerName"></h2>
  <div id="ticket"></div>
  <button onclick="closeTicket()">ΚΛΕΙΣΙΜΟ</button>
</div>

<script>
const params = new URLSearchParams(location.search);
const ticketParam = params.get("ticket");

// ===== ΚΟΥΠΟΝΙ (ΚΙΝΗΤΟ) =====
if(ticketParam){
  document.body.innerHTML="";
  openTicket(ticketParam);
  throw "";
}

// ===== ΚΛΗΡΩΣΗ (TV) =====
let numbers=[];
let interval=null;
let running=false;

const numberDiv=document.getElementById("number");
const drawnDiv=document.getElementById("drawn");
const manualBtn=document.getElementById("manualBtn");
const autoBtn=document.getElementById("autoBtn");
const stopBtn=document.getElementById("stopBtn");
const resetBtn=document.getElementById("resetBtn");

function initGame(){
  numbers=Array.from({length:75},(_,i)=>i+1);
  drawnDiv.innerHTML="";
  numberDiv.textContent="–";
}
function drawNumber(){
  if(numbers.length===0){ stopAuto(); alert("Τέλος!"); return; }
  const i=Math.floor(Math.random()*numbers.length);
  const n=numbers.splice(i,1)[0];
  numberDiv.textContent=n;
  numberDiv.classList.remove("animate");
  void numberDiv.offsetWidth;
  numberDiv.classList.add("animate");

  const d=document.createElement("div");
  d.className="drawn-number";
  d.textContent=n;
  drawnDiv.appendChild(d);
}
manualBtn.onclick=()=>{ if(!running) drawNumber(); };
autoBtn.onclick=()=>{
  if(running) return;
  running=true;
  autoBtn.disabled=true;
  manualBtn.disabled=true;
  stopBtn.disabled=false;
  drawNumber();
  interval=setInterval(drawNumber,5000);
};
function stopAuto(){
  running=false;
  clearInterval(interval);
  autoBtn.disabled=false;
  manualBtn.disabled=false;
  stopBtn.disabled=true;
}
stopBtn.onclick=stopAuto;
resetBtn.onclick=()=>{ stopAuto(); initGame(); };
initGame();

// ===== QR + TICKET =====
createTicketBtn.onclick=async()=>{
  const name=document.getElementById("name").value.trim();
  if(!name) return alert("Βάλε όνομα");
  let nums=[];
  while(nums.length<15){
    let n=Math.floor(Math.random()*75)+1;
    if(!nums.includes(n)) nums.push(n);
  }
  const data=btoa(JSON.stringify({name,nums}));
  const link=location.origin+location.pathname+"?ticket="+data;
  qr.src=await QRCode.toDataURL(link);
};

function openTicket(data){
  document.body.innerHTML=`
    <h2>${JSON.parse(atob(data)).name}</h2>
    <div id="ticket"></div>
  `;
  const grid=document.getElementById("ticket");
  JSON.parse(atob(data)).nums.forEach(n=>{
    const c=document.createElement("div");
    c.className="cell";
    c.textContent=n;
    c.onclick=()=>c.classList.toggle("marked");
    grid.appendChild(c);
  });
}
</script>

</body>
</html>
